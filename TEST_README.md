# lib.ts テストガイド

このドキュメントでは、`lib.ts`のJestテストについて説明します。

## セットアップ

### 依存関係のインストール

```bash
npm install
```

### テストの実行

#### 基本的なテスト実行

```bash
npm test
```

#### ウォッチモードでのテスト実行

```bash
npm run test:watch
```

#### カバレッジ付きテスト実行

```bash
npm run test:coverage
```

## テスト対象の関数

### 1. `getThisMonthWorkList(baseDate: Date)`

指定された月のゴミ収集スケジュールの配列を生成する関数

**テストケース:**

- 基本的な月のテスト（28日、29日、30日、31日の月）
- 水曜日の不燃ごみ判定（第1・第3水曜日のみ）
- 月初の曜日パターン（日曜日〜土曜日開始）

### 2. `getWasteScheduleMessage(date: Date)`

UTC時刻をJSTに変換してから、今日と明日のゴミ収集情報のメッセージを生成する関数

**テストケース:**

- 境界値テスト（月初、月末、年末、閏年）
- メッセージフォーマットテスト
- エッジケーステスト（月末から翌月初への遷移）

## 重要な境界値テスト

### 1. 閏年の考慮

- 2024年2月29日（閏年）
- 2023年2月28日（平年）

### 2. 月末から翌月初への遷移

- 30日の月から31日の月
- 31日の月から30日の月
- 2月から3月

### 3. 水曜日の不燃ごみ判定

- 第1水曜日：不燃ごみ
- 第2水曜日：無し
- 第3水曜日：不燃ごみ
- 第4水曜日：無し
- 第5水曜日（ある場合）：無し

## テストファイル構造

```
src/
├── __tests__/
│   └── lib.test.ts    # メインテストファイル
├── lib.ts             # テスト対象ファイル
└── index.ts
```

## カバレッジ目標

このコードは一度作成したら文言以外の更新はほぼ行わないため、以下の点を重視：

1. **100%の関数カバレッジ** - すべての関数がテストされている
2. **100%の分岐カバレッジ** - すべての条件分岐がテストされている
3. **境界値の完全テスト** - 閏年、月末などの境界値
4. **エラーケースの考慮** - 月末から翌月初への遷移時のundefined処理

## 実行例

```bash
# テスト実行
$ npm test

# カバレッジ確認
$ npm run test:coverage

# 結果例
PASS  src/__tests__/lib.test.ts
  getThisMonthWorkList
    基本的な月のテスト
      ✓ 31日の月（1月）の正しいスケジュール生成
      ✓ 30日の月（4月）の正しいスケジュール生成
      ✓ 28日の2月（平年）の正しいスケジュール生成
      ✓ 29日の2月（閏年）の正しいスケジュール生成
    水曜日の不燃ごみ判定テスト
      ✓ 第1・第3水曜日が不燃ごみになること（2024年1月）
      ✓ 月初が水曜日の場合の不燃ごみ判定（2024年5月）
    月初の曜日パターンテスト
      ✓ 月初が日曜日の場合（2024年9月）
      ✓ 月初が土曜日の場合（2024年6月）
  getWasteScheduleMessage
    境界値テスト
      ✓ 月初（1日）のメッセージ
      ✓ 月末のメッセージ（31日の月）
      ✓ 年末（12月31日）のメッセージ
      ✓ 閏年の2月28日のメッセージ
      ✓ 閏年の2月29日のメッセージ
      ✓ 平年の2月28日のメッセージ
    メッセージフォーマットテスト
      ✓ 正しいフォーマットでメッセージが生成されること
      ✓ 第1・第3水曜日の不燃ごみメッセージ
      ✓ 金曜日の複合ごみメッセージ
    エッジケーステスト
      ✓ 月末から翌月初への遷移（30日→31日の月）
      ✓ 月末から翌月初への遷移（31日→30日の月）

Test Suites: 1 passed, 1 total
Tests:       20 passed, 20 total
```

## 注意事項

1. **日本時間基準**: すべてのテストは日本時間（JST, UTC+9）を基準としています
2. **固定日付使用**: テストでは固定の日付を使用して、結果の一貫性を保証しています
3. **境界値重視**: 月末、年末、閏年などの境界値を重点的にテストしています
4. **メッセージフォーマット**: 出力メッセージの形式も含めてテストしています
